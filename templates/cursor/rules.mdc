---
description: コード品質、テスト、コーディング規約に関する包括的なルール
alwaysApply: true
---

# コード品質とテストルール

このルールは、プロジェクト全体のコード品質、テスト、コーディング規約を定義します。

## コーディング規約

### 命名規則

- **変数・関数**: `camelCase` を使用
- **クラス・型・インターフェース**: `PascalCase` を使用
- **定数**: `UPPER_SNAKE_CASE` を使用
- **プライベートメンバー**: 先頭に `_` を付ける（言語によって異なる）

### コードスタイル

- インデントは2スペースまたは4スペースで統一（プロジェクト設定に従う）
- 行の長さは120文字以内を推奨
- 末尾の空白を削除する
- ファイル末尾に改行を1つ追加する

### ファイル構造

- 1ファイル1クラス/関数を原則とする
- 関連する機能は同じディレクトリにまとめる
- インポートは外部ライブラリ → 内部モジュールの順で整理

## コード品質

### エラーハンドリング

- すべての非同期処理でエラーハンドリングを実装する
- エラーメッセージは明確で、デバッグに役立つ情報を含める
- ユーザー向けエラーと開発者向けエラーを区別する
- エラーログには適切なコンテキスト情報を含める

### パフォーマンス

- 不要な再レンダリングや再計算を避ける
- 大量データの処理には適切なアルゴリズムを使用
- メモリリークを防ぐ（イベントリスナーの削除、タイマーのクリアなど）
- データベースクエリは最適化し、N+1問題を避ける

### セキュリティ

- ユーザー入力は必ずバリデーションとサニタイズを行う
- SQLインジェクション対策（パラメータ化クエリを使用）
- XSS対策（出力のエスケープ）
- 認証トークンは安全に保存・送信する
- 機密情報は環境変数に保存し、コードに直接書かない

## テスト

### テストの原則

- **単体テスト**: すべての公開関数・メソッドに対して作成
- **統合テスト**: 主要なワークフローに対して作成
- **E2Eテスト**: 重要なユーザーフローに対して作成

### テストの書き方

- **AAA パターン**: Arrange（準備）、Act（実行）、Assert（検証）の順で記述
- テスト名は「何をテストするか」が明確になるように記述
- 1つのテストケースで1つのことをテストする
- モックとスタブを適切に使用する

### テストカバレッジ

- カバレッジ目標: 80%以上
- 重要なビジネスロジックは100%カバレッジを目指す
- カバレッジレポートを定期的に確認する

### テストファイルの配置

- テストファイルは対象ファイルと同じディレクトリに `*.test.ts` または `*.spec.ts` として配置
- または `__tests__` ディレクトリに配置

## ドキュメント

### コメント

- 複雑なロジックには説明コメントを追加
- 関数やクラスには JSDoc 形式のコメントを記述
- `@param`、`@returns`、`@throws` を適切に使用
- 「なぜ」を説明するコメントを書く（「何を」はコードが示す）

### README

- プロジェクトのセットアップ手順を記載
- 主要な機能の使い方を記載
- 開発環境の構築方法を記載
- コントリビューションガイドラインを記載

## コードレビュー

### レビューの観点

- コードの正確性と動作確認
- パフォーマンスへの影響
- セキュリティ上の問題
- コードの可読性と保守性
- テストの適切性

### レビューのマナー

- 建設的なフィードバックを提供
- 承認する際は「LGTM」や「Approved」を明示
- 質問や懸念点は明確に伝える
- 小さな変更は迅速に承認する

## リファクタリング

- コードの重複を排除する
- 長い関数は適切なサイズに分割する
- マジックナンバーは定数として定義する
- デッドコードは削除する
- レガシーコードは段階的に改善する

## 依存関係管理

- 依存関係は定期的に更新する
- セキュリティ脆弱性のあるパッケージは即座に更新
- 不要な依存関係は削除する
- バージョンは固定（`package-lock.json`、`pnpm-lock.yaml` を使用）

## ドキュメント更新

### READMEの自動更新

仕様や機能が変更された場合、READMEを自動的に更新する：

1. **機能追加時**
   - 新しい機能の説明を「使用方法」セクションに追加
   - インストール手順を更新（必要に応じて）
   - クイックスタートの例を更新

2. **設定変更時**
   - 設定ファイルの変更内容を反映
   - 環境変数の追加・変更を記載
   - 設定例を更新

3. **API変更時**
   - APIの変更点を明確に記載
   - 破壊的変更は「Breaking Changes」セクションに記載
   - マイグレーションガイドを提供（必要に応じて）

4. **依存関係変更時**
   - 新しい依存関係の追加理由を記載
   - バージョン要件を更新
   - インストール手順を確認

### README更新のチェックリスト

コード変更時に以下を確認：

- [ ] 新機能の説明が追加されている
- [ ] 使用方法の例が更新されている
- [ ] インストール手順が正確である
- [ ] 設定方法が最新である
- [ ] 破壊的変更が明記されている
- [ ] コード例が動作することを確認
- [ ] リンクが有効である

### READMEの構造

READMEは以下の構造を維持する：

1. **プロジェクト名と説明**
2. **クイックスタート**
3. **インストール方法**
4. **使用方法**
5. **設定**
6. **開発**
7. **コントリビューション**
8. **ライセンス**

### ドキュメントの品質

- 明確で簡潔な説明
- 実際に動作するコード例
- スクリーンショットや図（必要に応じて）
- よくある質問（FAQ）セクション
- トラブルシューティングガイド（必要に応じて）
