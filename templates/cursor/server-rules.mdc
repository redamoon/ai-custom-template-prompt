---
description: サーバーサイドコード用のルール（より詳細なバックエンドルール）
globs: ["backend/server/**/*", "server/**/*"]
alwaysApply: false
---

# Server Rules

このルールは、サーバーサイドのコード（`backend/server/`、`server/`）に自動的に適用されます。

## サーバーアーキテクチャ

### ミドルウェア

- リクエストロギングミドルウェア
- エラーハンドリングミドルウェア
- 認証・認可ミドルウェア
- レート制限ミドルウェア

### ルーティング

- RESTful APIの設計原則に従う
- ルートハンドラーは薄く保つ
- ビジネスロジックはService層に

## データベース

### ORM/クエリビルダー

- 型安全なクエリビルダーを使用
- リレーションを適切に定義
- トランザクションを適切に管理

### マイグレーション

- スキーマ変更はマイグレーションで管理
- 本番環境でのマイグレーションは慎重に
- データ移行スクリプトを準備

## セキュリティ

### 認証

- JWTトークンの適切な管理
- リフレッシュトークンの実装
- パスワードリセット機能

### セキュリティヘッダー

- CORS設定
- Content Security Policy
- X-Frame-Options
- X-Content-Type-Options

## パフォーマンス

### キャッシング戦略

- アプリケーションレベルキャッシュ
- データベースクエリキャッシュ
- CDNの活用

### 非同期処理

- ジョブキュー（Bull、BullMQなど）
- イベント駆動アーキテクチャ
- WebSocket接続の管理

## モニタリング

### ロギング

- 構造化ログ（Winston、Pinoなど）
- ログレベル管理
- ログアグリゲーション

### メトリクス

- パフォーマンスメトリクス
- エラーレート監視
- リソース使用率監視

## デプロイメント

### 環境設定

- 環境変数で設定管理
- 設定のバリデーション
- シークレット管理

### スケーラビリティ

- 水平スケーリング対応
- ステートレス設計
- セッション管理
